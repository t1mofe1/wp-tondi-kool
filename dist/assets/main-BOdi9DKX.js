(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function u(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(t){if(t.ep)return;t.ep=!0;const n=u(t);fetch(t.href,n)}})();(function(){const r=document.getElementById("worker-modal");if(!r)return;const a=document.getElementById("worker-modal-backdrop"),u=document.getElementById("worker-modal-status"),c=document.getElementById("worker-modal-status-spinner"),t=document.getElementById("worker-modal-status-text"),n=r.querySelector("[data-modal-close]"),d=document.getElementById("worker-modal-content"),m=window.TondiWorkerModal||{};let h=null,s=null;function y(e){const o=new URL(window.location.href);e?o.searchParams.set("worker",e):o.searchParams.delete("worker"),window.history.pushState({worker:e||null},"",o)}function k(){return new URL(window.location.href).searchParams.get("worker")}function l(e,o=!1){u&&(u.hidden=!e,c&&(c.hidden=!o),t&&(t.textContent=e||""))}function g(){h=document.activeElement,r.setAttribute("aria-hidden","false"),a&&a.setAttribute("aria-hidden","false"),document.documentElement.classList.add("is-modal-open"),document.body.classList.add("is-modal-open"),n?.focus?.()}function f(){s&&(s.abort(),s=null),l(null),r.setAttribute("aria-hidden","true"),a&&a.setAttribute("aria-hidden","true"),document.documentElement.classList.remove("is-modal-open"),document.body.classList.remove("is-modal-open"),y(null),h?.focus?.()}async function w(e){if(!d)return;if(!m.ajaxUrl||!m.nonce){l("Viga konfiguratsioonis.");return}d.innerHTML="",l("Laeb...",!0),s&&s.abort(),s=new AbortController;const o=new FormData;o.append("action","tondi_worker_modal"),o.append("id",e),o.append("slug",e),o.append("nonce",m.nonce);try{const i=await fetch(m.ajaxUrl,{method:"POST",credentials:"same-origin",body:o,signal:s.signal}),p=await i.json();if(!i.ok||!p?.success){l(p?.data?.message||p?.message||"Tekkis viga laadimisel.");return}d.innerHTML=p?.data?.html||""}catch(i){if(i&&i.name==="AbortError")return;l("Tekkis viga laadimisel.")}finally{l(null),s=null}}document.addEventListener("click",e=>{const o=e.target.closest("[data-worker-modal]");if(!o)return;const i=o.getAttribute("data-worker-modal");i&&(e.preventDefault(),g(),y(i),w(i))}),r.addEventListener("click",e=>{(e.target.matches("[data-modal-close]")||e.target.closest("[data-modal-close]"))&&f()}),a?.addEventListener("click",f),document.addEventListener("keydown",e=>{r.getAttribute("aria-hidden")==="false"&&e.key==="Escape"&&f()});const b=k();b&&(g(),w(b)),window.addEventListener("popstate",e=>{const o=k();o?(r.getAttribute("aria-hidden")!=="false"&&g(),w(o)):r.getAttribute("aria-hidden")==="false"&&f()})})();
