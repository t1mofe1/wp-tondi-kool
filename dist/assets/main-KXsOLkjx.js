(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function u(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(e){if(e.ep)return;e.ep=!0;const o=u(e);fetch(e.href,o)}})();(function(){const n=document.getElementById("worker-modal");if(!n)return;const s=document.getElementById("worker-modal-backdrop"),u=document.getElementById("worker-modal-status"),c=document.getElementById("worker-modal-status-spinner"),e=document.getElementById("worker-modal-status-text"),o=n.querySelector("[data-modal-close]"),l=document.getElementById("worker-modal-content"),f=window.TondiWorkerModal||{};let k=null,i=null;function h(t){const r=new URL(window.location.href);t?r.searchParams.set("worker",t):r.searchParams.delete("worker"),window.history.pushState({worker:t||null},"",r)}function y(){return new URL(window.location.href).searchParams.get("worker")}function d(t,r=!1){u&&(u.hidden=!t,c&&(c.hidden=!r),e&&(e.textContent=t||""))}function w(){k=document.activeElement,n.setAttribute("aria-hidden","false"),s&&s.setAttribute("aria-hidden","false"),document.documentElement.classList.add("lock"),document.body.classList.add("lock"),o?.focus?.()}function m(){i&&(i.abort(),i=null),d(null),n.setAttribute("aria-hidden","true"),s&&s.setAttribute("aria-hidden","true"),document.documentElement.classList.remove("lock"),document.body.classList.remove("lock"),h(null),k?.focus?.()}async function p(t){if(!l)return;if(!f.ajaxUrl||!f.nonce){d("Viga konfiguratsioonis.");return}l.innerHTML="",d("Laeb...",!0),i&&i.abort(),i=new AbortController;const r=new FormData;r.append("action","tondi_worker_modal"),r.append("slug",t),r.append("nonce",f.nonce);try{const a=await fetch(f.ajaxUrl,{method:"POST",credentials:"same-origin",body:r,signal:i.signal}),g=await a.json();if(!a.ok||!g?.success){d(g?.data?.message||g?.message||"Tekkis viga laadimisel.");return}l.innerHTML=g?.data?.html||""}catch(a){if(a&&a.name==="AbortError")return;d("Tekkis viga laadimisel.")}finally{d(null),i=null}}document.addEventListener("click",t=>{const r=t.target.closest("[data-worker-modal]");if(!r)return;const a=r.getAttribute("data-worker-modal");a&&(t.preventDefault(),w(),h(a),p(a))}),n.addEventListener("click",t=>{(t.target.matches("[data-modal-close]")||t.target.closest("[data-modal-close]"))&&m()}),s?.addEventListener("click",m),document.addEventListener("keydown",t=>{n.getAttribute("aria-hidden")==="false"&&t.key==="Escape"&&m()});const b=y();b&&(w(),p(b)),window.addEventListener("popstate",t=>{const r=y();r?(n.getAttribute("aria-hidden")!=="false"&&w(),p(r)):n.getAttribute("aria-hidden")==="false"&&m()})})();
