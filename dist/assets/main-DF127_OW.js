(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const g of f.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function v(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerPolicy&&(f.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?f.credentials="include":i.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(i){if(i.ep)return;i.ep=!0;const f=v(i);fetch(i.href,f)}})();function D(){const n=document.getElementById("worker-modal");if(!n)return;const t=document.getElementById("worker-modal-backdrop"),v=document.getElementById("worker-modal-status"),r=document.getElementById("worker-modal-status-spinner"),i=document.getElementById("worker-modal-status-text"),f=n.querySelector("[data-modal-close]"),g=document.getElementById("worker-modal-content"),w=window.TondiWorkerModal||{};let k=null,p=null;function E(o){const a=new URL(window.location.href);o?a.searchParams.set("worker",o):a.searchParams.delete("worker"),window.history.pushState({worker:o||null},"",a)}function y(){return new URL(window.location.href).searchParams.get("worker")}function m(o,a=!1){v&&(v.hidden=!o,r&&(r.hidden=!a),i&&(i.textContent=o||""))}function l(){k=document.activeElement,n.setAttribute("aria-hidden","false"),t&&t.setAttribute("aria-hidden","false"),document.documentElement.classList.add("lock"),document.body.classList.add("lock"),f?.focus?.()}function c(){p&&(p.abort(),p=null),m(null),n.setAttribute("aria-hidden","true"),t&&t.setAttribute("aria-hidden","true"),document.documentElement.classList.remove("lock"),document.body.classList.remove("lock"),E(null),k?.focus?.()}async function b(o){if(!g)return;if(!w.ajaxUrl||!w.nonce){m("Viga konfiguratsioonis.");return}g.innerHTML="",m("Laeb...",!0),p&&p.abort(),p=new AbortController;const a=new FormData;a.append("action","tondi_worker_modal"),a.append("slug",o),a.append("nonce",w.nonce);try{const L=await fetch(w.ajaxUrl,{method:"POST",credentials:"same-origin",body:a,signal:p.signal}),S=await L.json();if(!L.ok||!S?.success){m(S?.data?.message||S?.message||"Tekkis viga laadimisel.");return}g.innerHTML=S?.data?.html||""}catch(L){if(L&&L.name==="AbortError")return;m("Tekkis viga laadimisel.")}finally{m(null),p=null}}document.addEventListener("click",o=>{const a=o.target.closest("[data-worker-modal]");if(!a)return;const L=a.getAttribute("data-worker-modal");L&&(o.preventDefault(),l(),E(L),b(L))}),n.addEventListener("click",o=>{(o.target.matches("[data-modal-close]")||o.target.closest("[data-modal-close]"))&&c()}),t?.addEventListener("click",c),document.addEventListener("keydown",o=>{n.getAttribute("aria-hidden")==="false"&&o.key==="Escape"&&c()});const u=y();u&&(l(),b(u)),window.addEventListener("popstate",o=>{const a=y();a?(n.getAttribute("aria-hidden")!=="false"&&l(),b(a)):n.getAttribute("aria-hidden")==="false"&&c()})}function Y(){const n=Array.from(document.querySelectorAll(".js-gallery-item")),t=document.querySelector(".gallery-lightbox");if(!t||!n.length)return;const v=t.querySelector(".gallery-lightbox__stage");let r=t.querySelector(".gallery-lightbox__img.is-active");const i=t.querySelector("figcaption"),f=t.querySelector(".gallery-lightbox__close"),g=t.querySelector(".gallery-lightbox__backdrop"),w=t.querySelector(".gallery-lightbox__prev"),k=t.querySelector(".gallery-lightbox__next"),p=t.querySelector(".gallery-lightbox__counter");if(!v||!r||!f||!g||!i)return;let E=null,y=0,m=!1,l=!1,c=0,b=0,u=!1;function o(e){document.body.classList.toggle("lock",!!e)}function a(e){m&&e.preventDefault()}t.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("gesturestart",a,{passive:!1}),document.addEventListener("gesturechange",a,{passive:!1}),document.addEventListener("gestureend",a,{passive:!1});function L(e){const s=parseInt(String(e||""),10);return Number.isFinite(s)?s:null}function S(e){return L(n[e]?.dataset?.id)}function T(e){return n.findIndex(s=>L(s.dataset?.id)===e)}function B(){const e=new URL(window.location.href);return L(e.searchParams.get("photo"))}function I(e,s="replace"){const h=new URL(window.location.href);e?h.searchParams.set("photo",String(e)):h.searchParams.delete("photo");const d=h.searchParams.toString(),x=h.pathname+(d?`?${d}`:"");s==="push"?history.pushState({photo:e||null},"",x):history.replaceState({photo:e||null},"",x)}function M(e){if(!e)return;const s=new Image;s.src=e}function j(e){i.textContent=e||"",p&&(p.textContent=`${y+1} / ${n.length}`)}function N(e,s){r.src=e||"",r.alt=s||"",r.classList.add("is-active"),r.style.transform="",r.style.opacity=""}function F(e,s){const h=document.createElement("img");return h.className="gallery-lightbox__img",h.alt=s||"",h.src=e||"",h}function H(e,s,h=1){if(l)return;l=!0;const d=F(e,s);d.style.transform=`translateX(${h*18}%)`,d.style.opacity="0",v.appendChild(d),d.getBoundingClientRect(),r.style.transform=`translateX(${h*-18}%)`,r.style.opacity="0",d.style.transform="translateX(0)",d.style.opacity="1";const x=()=>{r&&r.parentNode&&r.parentNode.removeChild(r),d.classList.add("is-active"),d.style.transform="",d.style.opacity="",r=d,l=!1};d.addEventListener("transitionend",x,{once:!0})}function U(e,{updateUrl:s=!0,animate:h=!1,direction:d=1}={}){y=(e+n.length)%n.length;const x=n[y],C=x.dataset?.full||"",$=x.dataset?.caption||"",O=S(y);j($),h?H(C,$,d):N(C,$);const W=n[(y+1)%n.length]?.dataset?.full,X=n[(y-1+n.length)%n.length]?.dataset?.full;M(W),M(X),s&&O&&I(O,"replace")}function A(e,s,{pushUrl:h=!0}={}){E=s||document.activeElement,m=!0,t.classList.add("is-open"),t.setAttribute("aria-hidden","false"),o(!0),U(e,{updateUrl:!1,animate:!1});const d=S(y);h&&d&&I(d,"push"),f.focus()}function _({updateUrl:e=!0}={}){m=!1,t.classList.remove("is-open"),t.setAttribute("aria-hidden","true"),o(!1),r.src="",r.alt="",e&&I(null,"push"),E&&typeof E.focus=="function"&&E.focus()}function q(){U(y+1,{updateUrl:!0,animate:!0,direction:1})}function P(){U(y-1,{updateUrl:!0,animate:!0,direction:-1})}n.forEach((e,s)=>{e.addEventListener("click",()=>A(s,e,{pushUrl:!0}))}),f.addEventListener("click",()=>_({updateUrl:!0})),g.addEventListener("click",()=>_({updateUrl:!0})),k&&k.addEventListener("click",q),w&&w.addEventListener("click",P),v.addEventListener("click",e=>{m&&(e.target.closest(".gallery-lightbox__nav, .gallery-lightbox__close")||_({updateUrl:!0}))}),document.addEventListener("keydown",e=>{m&&(e.key==="Escape"&&_({updateUrl:!0}),e.key==="ArrowRight"&&q(),e.key==="ArrowLeft"&&P())}),t.addEventListener("pointerdown",e=>{m&&(u=!0,c=e.clientX,b=e.clientY)}),t.addEventListener("pointerup",e=>{if(!m||!u)return;u=!1;const s=e.clientX-c,h=e.clientY-b;if(Math.abs(h)>Math.abs(s))return;const d=40;s>d&&P(),s<-d&&q()}),t.addEventListener("pointercancel",()=>{u=!1}),window.addEventListener("popstate",()=>{const e=B();if(!e){m&&_({updateUrl:!1});return}const s=T(e);s!==-1&&(m?U(s,{updateUrl:!1,animate:!1}):A(s,null,{pushUrl:!1}))});const R=B();if(R){const e=T(R);e!==-1&&A(e,null,{pushUrl:!1})}}function G(){const n=window.TondiLiveSearch;if(!n)return;const t=document.getElementById("site-search-modal");if(!t)return;const v=t.querySelector('input[type="search"][name="s"]'),r=t.querySelector(".site-search-modal__results"),i=t.querySelector('form[role="search"]');if(!v||!r||!i)return;let f=null,g=null;const w=l=>String(l).replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[c]),k=(l,c)=>{const b=w(l),u=c.trim().split(/\s+/).filter(a=>a.length>=2);if(!u.length)return b;const o=new RegExp(`(${u.map(a=>a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`,"ig");return b.replace(o,"<mark>$1</mark>")},p=()=>{r.hidden=!0,r.innerHTML=""},E=(l,c)=>{if(r.hidden=!1,!l.length){r.innerHTML='<div class="live-search-empty">Tulemusi ei leitud</div>';return}const b=l.map(u=>{const o=k(u.title,c),a=u.subtitle?`<div class="live-search-sub">${w(u.subtitle)}</div>`:"";return`
        <a class="live-search-item live-search-item--${w(u.type)}" href="${w(u.url)}">
          <span class="live-search-badge">${w(u.label)}</span>
          <span class="live-search-main">
            <span class="live-search-title">${o}</span>
            ${a}
          </span>
        </a>
      `}).join("");r.innerHTML=`<div class="live-search-list">${b}</div>`},y=async l=>{g&&g.abort(),g=new AbortController;const c=new URL(n.ajaxUrl);c.searchParams.set("action","tondi_live_search"),c.searchParams.set("nonce",n.nonce),c.searchParams.set("q",l);const u=await(await fetch(c.toString(),{signal:g.signal})).json();return!u||!u.success?[]:u.data?.items||[]},m=()=>{const l=v.value.trim();if(l.length<(n.minLen||2)){p();return}clearTimeout(f),f=setTimeout(async()=>{try{const c=await y(l);E(c,l)}catch(c){c?.name!=="AbortError"&&p()}},220)};v.addEventListener("input",m),i.addEventListener("submit",()=>p()),document.addEventListener("click",l=>{l.target.closest("[data-search-close]")&&p()}),v.addEventListener("keydown",l=>{l.key==="Escape"&&p()})}document.addEventListener("DOMContentLoaded",()=>{D(),Y(),G()});
