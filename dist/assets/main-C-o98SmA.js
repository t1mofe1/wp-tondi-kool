(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function u(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(e){if(e.ep)return;e.ep=!0;const r=u(e);fetch(e.href,r)}})();(function(){const n=document.getElementById("worker-modal");if(!n)return;const s=document.getElementById("worker-modal-backdrop"),u=document.getElementById("worker-modal-status"),c=document.getElementById("worker-modal-status-spinner"),e=document.getElementById("worker-modal-status-text"),r=n.querySelector("[data-modal-close]"),l=document.getElementById("worker-modal-content"),m=window.TondiWorkerModal||{};let h=null,i=null;function k(t){const o=new URL(window.location.href);t?o.searchParams.set("worker",t):o.searchParams.delete("worker"),window.history.pushState({worker:t||null},"",o)}function y(){return new URL(window.location.href).searchParams.get("worker")}function d(t,o=!1){u&&(u.hidden=!t,c&&(c.hidden=!o),e&&(e.textContent=t||""))}function p(){h=document.activeElement,n.setAttribute("aria-hidden","false"),s&&s.setAttribute("aria-hidden","false"),document.documentElement.classList.add("is-modal-open"),document.body.classList.add("is-modal-open"),r?.focus?.()}function f(){i&&(i.abort(),i=null),d(null),n.setAttribute("aria-hidden","true"),s&&s.setAttribute("aria-hidden","true"),document.documentElement.classList.remove("is-modal-open"),document.body.classList.remove("is-modal-open"),k(null),h?.focus?.()}async function w(t){if(!l)return;if(!m.ajaxUrl||!m.nonce){d("Viga konfiguratsioonis.");return}l.innerHTML="",d("Laeb...",!0),i&&i.abort(),i=new AbortController;const o=new FormData;o.append("action","tondi_worker_modal"),o.append("slug",t),o.append("nonce",m.nonce);try{const a=await fetch(m.ajaxUrl,{method:"POST",credentials:"same-origin",body:o,signal:i.signal}),g=await a.json();if(!a.ok||!g?.success){d(g?.data?.message||g?.message||"Tekkis viga laadimisel.");return}l.innerHTML=g?.data?.html||""}catch(a){if(a&&a.name==="AbortError")return;d("Tekkis viga laadimisel.")}finally{d(null),i=null}}document.addEventListener("click",t=>{const o=t.target.closest("[data-worker-modal]");if(!o)return;const a=o.getAttribute("data-worker-modal");a&&(t.preventDefault(),p(),k(a),w(a))}),n.addEventListener("click",t=>{(t.target.matches("[data-modal-close]")||t.target.closest("[data-modal-close]"))&&f()}),s?.addEventListener("click",f),document.addEventListener("keydown",t=>{n.getAttribute("aria-hidden")==="false"&&t.key==="Escape"&&f()});const b=y();b&&(p(),w(b)),window.addEventListener("popstate",t=>{const o=y();o?(n.getAttribute("aria-hidden")!=="false"&&p(),w(o)):n.getAttribute("aria-hidden")==="false"&&f()})})();
