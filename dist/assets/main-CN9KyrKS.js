(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const g of f.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function w(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerPolicy&&(f.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?f.credentials="include":i.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(i){if(i.ep)return;i.ep=!0;const f=w(i);fetch(i.href,f)}})();function X(){const n=document.getElementById("worker-modal");if(!n)return;const t=document.getElementById("worker-modal-backdrop"),w=document.getElementById("worker-modal-status"),r=document.getElementById("worker-modal-status-spinner"),i=document.getElementById("worker-modal-status-text"),f=n.querySelector("[data-modal-close]"),g=document.getElementById("worker-modal-content"),v=window.TondiWorkerModal||{};let E=null,h=null;function k(a){const o=new URL(window.location.href);a?o.searchParams.set("worker",a):o.searchParams.delete("worker"),window.history.pushState({worker:a||null},"",o)}function y(){return new URL(window.location.href).searchParams.get("worker")}function p(a,o=!1){w&&(w.hidden=!a,r&&(r.hidden=!o),i&&(i.textContent=a||""))}function l(){E=document.activeElement,n.setAttribute("aria-hidden","false"),t&&t.setAttribute("aria-hidden","false"),document.documentElement.classList.add("lock"),document.body.classList.add("lock"),f?.focus?.()}function c(){h&&(h.abort(),h=null),p(null),n.setAttribute("aria-hidden","true"),t&&t.setAttribute("aria-hidden","true"),document.documentElement.classList.remove("lock"),document.body.classList.remove("lock"),k(null),E?.focus?.()}async function L(a){if(!g)return;if(!v.ajaxUrl||!v.nonce){p("Viga konfiguratsioonis.");return}g.innerHTML="",p("Laeb...",!0),h&&h.abort(),h=new AbortController;const o=new FormData;o.append("action","tondi_worker_modal"),o.append("slug",a),o.append("nonce",v.nonce);try{const b=await fetch(v.ajaxUrl,{method:"POST",credentials:"same-origin",body:o,signal:h.signal}),S=await b.json();if(!b.ok||!S?.success){p(S?.data?.message||S?.message||"Tekkis viga laadimisel.");return}g.innerHTML=S?.data?.html||""}catch(b){if(b&&b.name==="AbortError")return;p("Tekkis viga laadimisel.")}finally{p(null),h=null}}document.addEventListener("click",a=>{const o=a.target.closest("[data-worker-modal]");if(!o)return;const b=o.getAttribute("data-worker-modal");b&&(a.preventDefault(),l(),k(b),L(b))}),n.addEventListener("click",a=>{(a.target.matches("[data-modal-close]")||a.target.closest("[data-modal-close]"))&&c()}),t?.addEventListener("click",c),document.addEventListener("keydown",a=>{n.getAttribute("aria-hidden")==="false"&&a.key==="Escape"&&c()});const u=y();u&&(l(),L(u)),window.addEventListener("popstate",a=>{const o=y();o?(n.getAttribute("aria-hidden")!=="false"&&l(),L(o)):n.getAttribute("aria-hidden")==="false"&&c()})}function D(){const n=Array.from(document.querySelectorAll(".js-gallery-item")),t=document.querySelector(".gallery-lightbox");if(!t||!n.length)return;const w=t.querySelector(".gallery-lightbox__stage");let r=t.querySelector(".gallery-lightbox__img.is-active");const i=t.querySelector("figcaption"),f=t.querySelector(".gallery-lightbox__close"),g=t.querySelector(".gallery-lightbox__backdrop"),v=t.querySelector(".gallery-lightbox__prev"),E=t.querySelector(".gallery-lightbox__next"),h=t.querySelector(".gallery-lightbox__counter");if(!w||!r||!f||!g||!i)return;let k=null,y=0,p=!1,l=!1,c=0,L=0,u=!1;function a(e){document.body.classList.toggle("lock",!!e)}function o(e){const s=parseInt(String(e||""),10);return Number.isFinite(s)?s:null}function b(e){return o(n[e]?.dataset?.id)}function S(e){return n.findIndex(s=>o(s.dataset?.id)===e)}function T(){const e=new URL(window.location.href);return o(e.searchParams.get("photo"))}function _(e,s="replace"){const m=new URL(window.location.href);e?m.searchParams.set("photo",String(e)):m.searchParams.delete("photo");const d=m.searchParams.toString(),x=m.pathname+(d?`?${d}`:"");s==="push"?history.pushState({photo:e||null},"",x):history.replaceState({photo:e||null},"",x)}function B(e){if(!e)return;const s=new Image;s.src=e}function O(e){i.textContent=e||"",h&&(h.textContent=`${y+1} / ${n.length}`)}function j(e,s){r.src=e||"",r.alt=s||"",r.classList.add("is-active"),r.style.transform="",r.style.opacity=""}function N(e,s){const m=document.createElement("img");return m.className="gallery-lightbox__img",m.alt=s||"",m.src=e||"",m}function F(e,s,m=1){if(l)return;l=!0;const d=N(e,s);d.style.transform=`translateX(${m*18}%)`,d.style.opacity="0",w.appendChild(d),d.getBoundingClientRect(),r.style.transform=`translateX(${m*-18}%)`,r.style.opacity="0",d.style.transform="translateX(0)",d.style.opacity="1";const x=()=>{r&&r.parentNode&&r.parentNode.removeChild(r),d.classList.add("is-active"),d.style.transform="",d.style.opacity="",r=d,l=!1};d.addEventListener("transitionend",x,{once:!0})}function U(e,{updateUrl:s=!0,animate:m=!1,direction:d=1}={}){y=(e+n.length)%n.length;const x=n[y],R=x.dataset?.full||"",$=x.dataset?.caption||"",C=b(y);O($),m?F(R,$,d):j(R,$);const H=n[(y+1)%n.length]?.dataset?.full,W=n[(y-1+n.length)%n.length]?.dataset?.full;B(H),B(W),s&&C&&_(C,"replace")}function A(e,s,{pushUrl:m=!0}={}){k=s||document.activeElement,p=!0,t.classList.add("is-open"),t.setAttribute("aria-hidden","false"),a(!0),U(e,{updateUrl:!1,animate:!1});const d=b(y);m&&d&&_(d,"push"),f.focus()}function I({updateUrl:e=!0}={}){p=!1,t.classList.remove("is-open"),t.setAttribute("aria-hidden","true"),a(!1),r.src="",r.alt="",e&&_(null,"push"),k&&typeof k.focus=="function"&&k.focus()}function q(){U(y+1,{updateUrl:!0,animate:!0,direction:1})}function P(){U(y-1,{updateUrl:!0,animate:!0,direction:-1})}n.forEach((e,s)=>{e.addEventListener("click",()=>A(s,e,{pushUrl:!0}))}),f.addEventListener("click",()=>I({updateUrl:!0})),g.addEventListener("click",()=>I({updateUrl:!0})),E&&E.addEventListener("click",q),v&&v.addEventListener("click",P),document.addEventListener("keydown",e=>{p&&(e.key==="Escape"&&I({updateUrl:!0}),e.key==="ArrowRight"&&q(),e.key==="ArrowLeft"&&P())}),t.addEventListener("pointerdown",e=>{p&&(u=!0,c=e.clientX,L=e.clientY)}),t.addEventListener("pointerup",e=>{if(!p||!u)return;u=!1;const s=e.clientX-c,m=e.clientY-L;if(Math.abs(m)>Math.abs(s))return;const d=40;s>d&&P(),s<-d&&q()}),t.addEventListener("pointercancel",()=>{u=!1}),window.addEventListener("popstate",()=>{const e=T();if(!e){p&&I({updateUrl:!1});return}const s=S(e);s!==-1&&(p?U(s,{updateUrl:!1,animate:!1}):A(s,null,{pushUrl:!1}))});const M=T();if(M){const e=S(M);e!==-1&&A(e,null,{pushUrl:!1})}}function Y(){const n=window.TondiLiveSearch;if(!n)return;const t=document.getElementById("site-search-modal");if(!t)return;const w=t.querySelector('input[type="search"][name="s"]'),r=t.querySelector(".site-search-modal__results"),i=t.querySelector('form[role="search"]');if(!w||!r||!i)return;let f=null,g=null;const v=l=>String(l).replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[c]),E=(l,c)=>{const L=v(l),u=c.trim().split(/\s+/).filter(o=>o.length>=2);if(!u.length)return L;const a=new RegExp(`(${u.map(o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")})`,"ig");return L.replace(a,"<mark>$1</mark>")},h=()=>{r.hidden=!0,r.innerHTML=""},k=(l,c)=>{if(r.hidden=!1,!l.length){r.innerHTML='<div class="live-search-empty">Tulemusi ei leitud</div>';return}const L=l.map(u=>{const a=E(u.title,c),o=u.subtitle?`<div class="live-search-sub">${v(u.subtitle)}</div>`:"";return`
        <a class="live-search-item live-search-item--${v(u.type)}" href="${v(u.url)}">
          <span class="live-search-badge">${v(u.label)}</span>
          <span class="live-search-main">
            <span class="live-search-title">${a}</span>
            ${o}
          </span>
        </a>
      `}).join("");r.innerHTML=`<div class="live-search-list">${L}</div>`},y=async l=>{g&&g.abort(),g=new AbortController;const c=new URL(n.ajaxUrl);c.searchParams.set("action","tondi_live_search"),c.searchParams.set("nonce",n.nonce),c.searchParams.set("q",l);const u=await(await fetch(c.toString(),{signal:g.signal})).json();return!u||!u.success?[]:u.data?.items||[]},p=()=>{const l=w.value.trim();if(l.length<(n.minLen||2)){h();return}clearTimeout(f),f=setTimeout(async()=>{try{const c=await y(l);k(c,l)}catch(c){c?.name!=="AbortError"&&h()}},220)};w.addEventListener("input",p),i.addEventListener("submit",()=>h()),document.addEventListener("click",l=>{l.target.closest("[data-search-close]")&&h()}),w.addEventListener("keydown",l=>{l.key==="Escape"&&h()})}document.addEventListener("DOMContentLoaded",()=>{X(),D(),Y()});
