(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&s(g)}).observe(document,{childList:!0,subtree:!0});function h(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(i){if(i.ep)return;i.ep=!0;const d=h(i);fetch(i.href,d)}})();function D(){const r=document.getElementById("worker-modal");if(!r)return;const n=document.getElementById("worker-modal-backdrop"),h=document.getElementById("worker-modal-status"),s=document.getElementById("worker-modal-status-spinner"),i=document.getElementById("worker-modal-status-text"),d=r.querySelector("[data-modal-close]"),g=document.getElementById("worker-modal-content"),y=window.TondiWorkerModal||{};let S=null,p=null;function w(a){const l=new URL(window.location.href);a?l.searchParams.set("worker",a):l.searchParams.delete("worker"),window.history.pushState({worker:a||null},"",l)}function f(){return new URL(window.location.href).searchParams.get("worker")}function u(a,l=!1){h&&(h.hidden=!a,s&&(s.hidden=!l),i&&(i.textContent=a||""))}function k(){S=document.activeElement,r.setAttribute("aria-hidden","false"),n&&n.setAttribute("aria-hidden","false"),document.documentElement.classList.add("lock"),document.body.classList.add("lock"),d?.focus?.()}function L(){p&&(p.abort(),p=null),u(null),r.setAttribute("aria-hidden","true"),n&&n.setAttribute("aria-hidden","true"),document.documentElement.classList.remove("lock"),document.body.classList.remove("lock"),w(null),S?.focus?.()}async function x(a){if(!g)return;if(!y.ajaxUrl||!y.nonce){u("Viga konfiguratsioonis.");return}g.innerHTML="",u("Laeb...",!0),p&&p.abort(),p=new AbortController;const l=new FormData;l.append("action","tondi_worker_modal"),l.append("slug",a),l.append("nonce",y.nonce);try{const m=await fetch(y.ajaxUrl,{method:"POST",credentials:"same-origin",body:l,signal:p.signal}),E=await m.json();if(!m.ok||!E?.success){u(E?.data?.message||E?.message||"Tekkis viga laadimisel.");return}g.innerHTML=E?.data?.html||""}catch(m){if(m&&m.name==="AbortError")return;u("Tekkis viga laadimisel.")}finally{u(null),p=null}}document.addEventListener("click",a=>{const l=a.target.closest("[data-worker-modal]");if(!l)return;const m=l.getAttribute("data-worker-modal");m&&(a.preventDefault(),k(),w(m),x(m))}),r.addEventListener("click",a=>{(a.target.matches("[data-modal-close]")||a.target.closest("[data-modal-close]"))&&L()}),n?.addEventListener("click",L),document.addEventListener("keydown",a=>{r.getAttribute("aria-hidden")==="false"&&a.key==="Escape"&&L()});const b=f();b&&(k(),x(b)),window.addEventListener("popstate",a=>{const l=f();l?(r.getAttribute("aria-hidden")!=="false"&&k(),x(l)):r.getAttribute("aria-hidden")==="false"&&L()})}function Y(){const r=Array.from(document.querySelectorAll(".js-gallery-item")),n=document.querySelector(".gallery-lightbox");if(!n||!r.length)return;const h=n.querySelector(".gallery-lightbox__stage");let s=n.querySelector(".gallery-lightbox__img.is-active");const i=n.querySelector("figcaption"),d=n.querySelector(".gallery-lightbox__close"),g=n.querySelector(".gallery-lightbox__backdrop"),y=n.querySelector(".gallery-lightbox__prev"),S=n.querySelector(".gallery-lightbox__next"),p=n.querySelector(".gallery-lightbox__counter");if(!h||!s||!d||!g||!i)return;let w=null,f=0,u=!1,k=!1,L=0,x=0,b=!1;function a(e){document.body.classList.toggle("lock",!!e)}function l(e){const t=parseInt(String(e||""),10);return Number.isFinite(t)?t:null}function m(e){return l(r[e]?.dataset?.id)}function E(e){return r.findIndex(t=>l(t.dataset?.id)===e)}function M(){const e=new URL(window.location.href);return l(e.searchParams.get("photo"))}function A(e,t="replace"){const c=new URL(window.location.href);e?c.searchParams.set("photo",String(e)):c.searchParams.delete("photo");const o=c.searchParams.toString(),v=c.pathname+(o?`?${o}`:"");t==="push"?history.pushState({photo:e||null},"",v):history.replaceState({photo:e||null},"",v)}function O(e){if(!e)return;const t=new Image;t.src=e}function F(e){i.textContent=e||"",p&&(p.textContent=`${f+1} / ${r.length}`)}function R(e,t){s.src=e||"",s.alt=t||"",s.classList.add("is-active"),s.style.transform="",s.style.opacity=""}function W(e,t){const c=document.createElement("img");return c.className="gallery-lightbox__img",c.alt=t||"",c.src=e||"",c}function X(e,t,c=1){if(k)return;k=!0;const o=W(e,t);o.style.transform=`translateX(${c*18}%)`,o.style.opacity="0",h.appendChild(o),o.getBoundingClientRect(),s.style.transform=`translateX(${c*-18}%)`,s.style.opacity="0",o.style.transform="translateX(0)",o.style.opacity="1";const v=()=>{s&&s.parentNode&&s.parentNode.removeChild(s),o.classList.add("is-active"),o.style.transform="",o.style.opacity="",s=o,k=!1};o.addEventListener("transitionend",v,{once:!0})}function U(e,{updateUrl:t=!0,animate:c=!1,direction:o=1}={}){f=(e+r.length)%r.length;const v=r[f],N=v.dataset?.full||"",B=v.dataset?.caption||"",T=m(f);F(B),c?X(N,B,o):R(N,B);const $=r[(f+1)%r.length]?.dataset?.full,j=r[(f-1+r.length)%r.length]?.dataset?.full;O($),O(j),t&&T&&A(T,"replace")}function _(e,t,{pushUrl:c=!0}={}){w=t||document.activeElement,u=!0,n.classList.add("is-open"),n.setAttribute("aria-hidden","false"),a(!0),U(e,{updateUrl:!1,animate:!1});const o=m(f);c&&o&&A(o,"push"),d.focus()}function I({updateUrl:e=!0}={}){u=!1,n.classList.remove("is-open"),n.setAttribute("aria-hidden","true"),a(!1),s.src="",s.alt="",e&&A(null,"push"),w&&typeof w.focus=="function"&&w.focus()}function P(){U(f+1,{updateUrl:!0,animate:!0,direction:1})}function q(){U(f-1,{updateUrl:!0,animate:!0,direction:-1})}r.forEach((e,t)=>{e.addEventListener("click",()=>_(t,e,{pushUrl:!0}))}),d.addEventListener("click",()=>I({updateUrl:!0})),g.addEventListener("click",()=>I({updateUrl:!0})),S&&S.addEventListener("click",P),y&&y.addEventListener("click",q),document.addEventListener("keydown",e=>{u&&(e.key==="Escape"&&I({updateUrl:!0}),e.key==="ArrowRight"&&P(),e.key==="ArrowLeft"&&q())}),n.addEventListener("pointerdown",e=>{u&&(b=!0,L=e.clientX,x=e.clientY)}),n.addEventListener("pointerup",e=>{if(!u||!b)return;b=!1;const t=e.clientX-L,c=e.clientY-x;if(Math.abs(c)>Math.abs(t))return;const o=40;t>o&&q(),t<-o&&P()}),n.addEventListener("pointercancel",()=>{b=!1}),window.addEventListener("popstate",()=>{const e=M();if(!e){u&&I({updateUrl:!1});return}const t=E(e);t!==-1&&(u?U(t,{updateUrl:!1,animate:!1}):_(t,null,{pushUrl:!1}))});const C=M();if(C){const e=E(C);e!==-1&&_(e,null,{pushUrl:!1})}}document.addEventListener("DOMContentLoaded",()=>{D(),Y()});
